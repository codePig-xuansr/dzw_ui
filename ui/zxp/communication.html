<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			.demo-table-expand {
				font-size: 0;
			}
			
			.demo-table-expand label {
				width: 90px;
				color: #99a9bf;
			}
			
			.demo-table-expand .el-form-item {
				margin-right: 0;
				margin-bottom: 0;
				width: 50%;
			}
		</style>
	</head>

	<body>
		<br />
		<div id="app">
			<template>
				<el-input type="text" style="width: 300px;margin-left: 0px;" placeholder="根据姓名模糊查询" v-model="username">
			</template>
			&nbsp;&nbsp;&nbsp;
			<el-button type="primary" plain @click="page(1,3,username)">查询</el-button>
			<br />
			<br />

			<el-row>
				<el-col :span="24">
					<el-table
    :data="vehicleInfo.list"
    style="width: 100%"
    row-key="uid"
    border
    lazy
    :load="load"
    :tree-props="{children: 'vehicleInfo', hasChildren: 'hasChildren'}">
						<el-table-column prop="depname" label="部门" style="color:#B3D8FF ;">
						</el-table-column>
						<el-table-column prop="rname" label="职位" style="color:#B3D8FF ;">
						</el-table-column>
						<el-table-column prop="uid" label="员工编号" style="color:#B3D8FF ;">
						</el-table-column>
						<el-table-column prop="username" label="姓名" style="color:#B3D8FF ;">
						</el-table-column>
						<el-table-column prop="phone" label="电话" style="color:#B3D8FF ;">
						</el-table-column>
						<el-table-column prop="email" label="邮箱" style="color:#B3D8FF ;">
						</el-table-column>
					</el-table>
					<el-pagination background prev-text="上一页" next-text="下一页" @size-change="sizec" @current-change="change" layout="total,prev, pager, next, jumper" :total="vehicleInfo.total"  :page-size="vehicleInfo.size">
				</el-col>
			</el-row>

			<!--<el-table
    :data="vehicleInfo.list"
    style="width: 100%">
    <el-table-column type="expand" >
      <template slot-scope="props">
        <el-form label-position="left" inline class="demo-table-expand">
          <el-form-item >
            <span>{{ props.row.phone }}</span>
          </el-form-item>
        </el-form>
      </template>
    </el-table-column>
    <el-table-column
      label="员工 ID"
      prop="uid">
    </el-table-column>
    <el-table-column
      label="员工项目"
      prop="username">
    </el-table-column>
    <el-table-column
      label="所属部门"
      prop="depname">
    </el-table-column>
     <el-table-column
      label="员工职位"
      prop="rname">
    </el-table-column>
     <el-table-column
      label="联系方式"
      prop="phone">
    </el-table-column>
     <el-table-column
      label="邮箱地址"
      prop="email">
    </el-table-column>
  </el-table>-->

		</div>
	</body>
	<script>
		var app = new Vue({
			el: '#app',
			data: {
				username: '',
				formLabelAlign: {
					user: {

					},
					txl: []
				},
				add: false,
				modify: false,
				piges: {},
				carlist: [],
				list: [],
				vehicleInfo: [],
				lazy:true,
			},
			methods: {
				delOne(uid) {
					let _this = this;
					if(window.confirm('是否确定删除？')) {
						$.ajax(`http://localhost:8080/zxp/api/user/delete/${uid}`, {
							type: "delete",
							dataType: "json",
							success(msg) {
								if(msg.code == "200") {
									alert("删除成功");
									_this.page(1, 3);
								} else {
									alert("删除失败");
								}
							}
						});
					}
				},
				load(tree, treeNode, resolve) {
					console.info("11");
					console.info(tree);
					console.info(treeNode);
					console.info(resolve);
					setTimeout(() => {
						resolve(this.vehicleInfo)
					}, 1000)
				},
				page(n, s, name, id) {
					let _this = this;
					if(name == "") {
						name = null;
					}
					jQuery.getJSON(`http://127.0.0.1:8080/zxp/api/txl/queryTxlAll/${n}/${s}/${name}/${id}`, function(pg) {
						_this.vehicleInfo = pg;
						_this.list = pg.list;
					});
				},
				//页数改变事件

				change(num) {
					let _this = this;
					this.page(num, _this.vehicleInfo.pageSize, _this.username,0);
				},
				//pageSize选择事件
				sizec(size) {
					let _this = this;
					this.page(1, size,_this.username,0);
				},
				//添加数据
				addall() {
					let _this = this;
					jQuery.ajax("http://127.0.0.1:8080/zxp/api/user/add", {
						type: 'post',
						data: JSON.stringify(_this.formLabelAlign),
						contentType: 'application/json; charset=UTF-8',
						success(data) {
							if(data == "ok") {
								alert("新增失败！");
							} else {
								alert("新增成功！");
								_this.add = false;
								_this.page(1, 3);
							}
						}
					});
				},
				updates() {
					let _this = this;
					alert(JSON.stringify(_this.formLabelAlign));
					$.ajax("http://localhost:8080/zxp/api/user/updatetxl", {
						type: "put",
						contentType: "application/json",
						data: JSON.stringify(_this.formLabelAlign),
						dataType: "json",
						success(msg) {
							if(msg.code == "200") {
								alert('保存成功');
								_this.modify = false;
								_this.page(1, 3);
							} else {
								alert('保存失败');
							}
						}
					});
				},
				update(uid) {
					let _this = this;
					_this.modify = true;
					$.getJSON(`http://127.0.0.1:8080/zxp/api/user/selectById/${uid}`,
						function(data) {
							_this.formLabelAlign = data;
						}
					);
				},
				updates() {
					let _this = this;
					$.ajax("http://localhost:8080/zxp/api/user/update", {
						type: "put",
						contentType: "application/json",
						data: JSON.stringify(_this.formLabelAlign),
						dataType: "json",
						success(msg) {
							if(msg.code == "200") {
								alert('保存成功');
								_this.modify = false;
								_this.page(1, 3);
							} else {
								alert('保存失败');
							}
						}
					});
				}
			},
			mounted() {
				let _this = this;
				_this.page(1, 3, null, 0);
			}
		});
	</script>

</html>